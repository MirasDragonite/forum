<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Page</title>
</head>
<body>

    {{if .Post}}

    <div class="post">
        <p> <b>Author:</b>  {{ .Post.PostAuthorName }} </p>
        <h2> <b>Title:</b>  {{ .Post.Title }}</h2>
        <p> <b>Content</b> {{ .Post.Content }}</p>
        <form action="/like-post/{{.Post.Id}}" method="POST">
        <button class="like-button liked" type="submit" name="button" value="like">like</button>
                        <span class="likes">{{.Likes}}</span>
                        <button class="dislike-button not-disliked" type="submit" name="button" value="dislike">dislike</button>
                        <span class="dislikes">{{.Dislikes}}</span>
                    </form>
        
    </div>


    <h3>Comments section</h3>
    <ul>
      
        {{ range .Post.Comments}}
        <li>
        <p>{{ .Content }}</p>
        <form action="/like-comment/{{.CommentID}}" method="POST">   
            
            <br>
                <button class="commButton" type="submit" name="commButton" value="like" >like</button>
                <span class="likes">{{.Like}}</span>
                <button class="commButton" type="submit" name="commButton" value="dislike">dislike</button>
                <span class="dislikes">{{.Dislike}}</span>
                         
      
        
    </form>
</li>
{{end }}
    </ul>

    <!-- Comment Form -->
    <form action="/post/{{.Post.Id}}" method="POST">
        <input type="hidden" name="postId" value="{{.Post.Id}}">
        <input type="text" name="commentContent"  class="commentContent" placeholder="Add a comment">
        <button class="submitComment" type="submit">Submit Comment</button>
    </form>

    <button> <a href="/"> Home </a> </button>
    {{ else }}
    <p>Post not found.</p>
    {{ end }}



    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const likeButton = document.querySelector(".like-button");
            const dislikeButton = document.querySelector(".dislike-button");
            const likesElement = document.querySelector(".likes");
            const dislikesElement = document.querySelector(".dislikes");
           

            if (likeButton) {
                likeButton.addEventListener("click", function (event) {
                    event.preventDefault();
    
                    // Send an AJAX request to update the reaction
                    fetch("/like-post/{{.Post.Id}}", {
                        method: "POST",
                        body: JSON.stringify({ reaction: "like" }),
                        headers: {
                            "Content-Type": "application/json",
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
    
                        // Update the like count in the HTML
                        likesElement.textContent = data.likes;
                        dislikesElement.textContent = data.dislikes;
                        // You can handle the response data here
                    })
                    .catch(error => {
                        console.error(error);
                    });
                });
            }
    
            if (dislikeButton) {
                dislikeButton.addEventListener("click", function (event) {
                    event.preventDefault();
    
                    // Send an AJAX request to update the reaction
                    fetch("/like-post/{{.Post.Id}}", {
                        method: "POST",
                        body: JSON.stringify({ reaction: "dislike" }),
                        headers: {
                            "Content-Type": "application/json",
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
    
                        // Update the dislike count in the HTML
                        likesElement.textContent = data.likes;
                        dislikesElement.textContent = data.dislikes;
    
                        // You can handle the response data here
                    })
                    .catch(error => {
                        console.error(error);
                    });
                });
            }

            const commentSubmit = document.querySelector(".submitComment");

if (commentSubmit) {
    commentSubmit.addEventListener("click", function (event) {
        event.preventDefault();

        // Get the comment content from the input field
        const commentInput = document.querySelector(".commentContent");
        const commentContent = commentInput.value;

        // Send the comment content as JSON
        fetch("/post/{{.Post.Id}}", {
            method: "POST",
            body: JSON.stringify({ content: commentContent }),
            headers: {
                "Content-Type": "application/json",
            },
        })
        .then(response => response.json())
        .then(data => {
            console.log(data.result);
            window.location.href = `/like-post/${data.result}`;
            // You can handle the response data here
        })
        .catch(error => {
            console.error(error);
        });
    });
}
        });

        
    </script>
    
</body>
</html>
