<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Page</title>
</head>
<body>

    {{if .Post}}

    <div class="post">
        <p> <b>Author:</b>  {{ .Post.PostAuthorName }} </p>
        <h2> <b>Title:</b>  {{ .Post.Title }}</h2>
        <p> <b>Content</b> {{ .Post.Content }}</p>
        <p>  <b>Topics:</b> </p>
        {{range .Post.Topic}}
            <ol>
                {{ if . }} 
                <li>{{.}}</li>
                {{else }}

                {{end}}
                
            </ol>
            
        {{end}}
        <form action="/like-post/{{.Post.Id}}" method="POST">
        {{if .Post.Liked}}
        <button class="like-button liked" type="submit" name="button" value="like" style="background-color: green;">like</button>
        {{else}}
        <button class="like-button liked" type="submit" name="button" value="like">like</button>
        {{end}}
                        <span class="likes">{{.Likes}}</span>
                        {{if .Post.Disliked}}
                        <button class="dislike-button not-disliked" type="submit" name="button" value="dislike" style="background-color:red ;">dislike</button>
                        {{else}}
                        <button class="dislike-button not-disliked" type="submit" name="button" value="dislike">dislike</button>
                        {{end}}
                        <span class="dislikes">{{.Dislikes}}</span>
                    </form>
        
    </div>


    <h3>Comments section</h3>
    <ul>

        {{ range .Post.Comments}}
        <li>
            <p> {{ .CommentAuthorName }}</p>
            <p>{{ .Content }}</p>
            <form action="/like-comment/{{.CommentID}}" method="POST">
                <br>

              {{if .Liked}}
              <button class="commButtonLike" type="submit" name="commButton" value="like" data-comment-id="{{.CommentID}}" style="background-color:green ;">like</button>
              {{else}}
              <button class="commButtonLike" type="submit" name="commButton" value="like" data-comment-id="{{.CommentID}}">like</button>
              {{end}}
                <span class="likes">{{.Like}}</span>
                {{if .Disliked}}
                <button class="commButtonDislike" type="submit" name="commButton" value="dislike" data-comment-id="{{.CommentID}}" style="background-color: red;">dislike</button>
                {{else}}
                <button class="commButtonDislike" type="submit" name="commButton" value="dislike" data-comment-id="{{.CommentID}}">dislike</button>
                {{end}}
                <span class="dislikes">{{.Dislike}}</span>
            </form>
        </li>
       
        


{{ end }}

    </ul>

    <!-- Comment Form -->
    <form action="/post/{{.Post.Id}}" method="POST">
        <input type="hidden" name="postId" value="{{.Post.Id}}">
        <input type="text" name="commentContent"  class="commentContent" placeholder="Add a comment">
        <button class="submitComment" type="submit">Submit Comment</button>
    </form>

    <button> <a href="/"> Home </a> </button>
    {{ else }}
    <p>Post not found.</p>
    {{ end }}



    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const likeButton = document.querySelector(".like-button");
            const dislikeButton = document.querySelector(".dislike-button");
            const likesElement = document.querySelector(".likes");
            const dislikesElement = document.querySelector(".dislikes");
           

            if (likeButton) {
                likeButton.addEventListener("click", function (event) {
                    event.preventDefault();
    
                    // Send an AJAX request to update the reaction
                    fetch("/like-post/{{.Post.Id}}", {
                        method: "POST",
                        body: JSON.stringify({ reaction: "like" }),
                        headers: {
                            "Content-Type": "application/json",
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
    
                        // Update the like count in the HTML
                        likesElement.textContent = data.likes;
                        dislikesElement.textContent = data.dislikes;
                        if (data.reaction === 1) {
                           likeButton.style.backgroundColor = "green";
                           dislikeButton.style.backgroundColor ="";
                      } else {
                     likeButton.style.backgroundColor = ""; // Reset the background color
                      }
                        // You can handle the response data here
                    })
                    .catch(error => {
                        console.error(error);
                    });
                });
            }
    
            if (dislikeButton) {
                dislikeButton.addEventListener("click", function (event) {
                    event.preventDefault();
    
                    // Send an AJAX request to update the reaction
                    fetch("/like-post/{{.Post.Id}}", {
                        method: "POST",
                        body: JSON.stringify({ reaction: "dislike" }),
                        headers: {
                            "Content-Type": "application/json",
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
    
                        // Update the dislike count in the HTML
                        likesElement.textContent = data.likes;
                        dislikesElement.textContent = data.dislikes;
    
                        if (data.reaction === -1) {
                            dislikeButton.style.backgroundColor = "red";
                            likeButton.style.backgroundColor ="";
                      } else {
                        dislikeButton.style.backgroundColor = ""; // Reset the background color
                      }
                        // You can handle the response data here
                    })
                    .catch(error => {
                        console.error(error);
                    });
                });
            }

            const commentSubmit = document.querySelector(".submitComment");
            
if (commentSubmit) {
    commentSubmit.addEventListener("click", function (event) {
        event.preventDefault();
      

        // Get the comment content from the input field
        const commentInput = document.querySelector(".commentContent");
        const commentContent = commentInput.value;

        // Send the comment content as JSON
        fetch("/post/{{.Post.Id}}", {
            method: "POST",
            body: JSON.stringify({ content: commentContent }),
            headers: {
                "Content-Type": "application/json",
            },
        })
        .then(response => response.json())
        .then(data => {

            console.log(data);
            // You can handle the response data here
        })
        .catch(error => {
            console.log(error)
            console.error(error);
        });
    });
}


const likeButtonsComment = document.querySelectorAll(".commButtonLike");
    const dislikeButtonsComment = document.querySelectorAll(".commButtonDislike");

    likeButtonsComment.forEach(likeButtonComment => {
        likeButtonComment.addEventListener("click", function (event) {
            event.preventDefault();

            const commentID = likeButtonComment.getAttribute("data-comment-id");

            // Select the like and dislike counts for the specific comment
            const likesElement = likeButtonComment.nextElementSibling;
           const dislikeButtonComment = likeButtonComment.nextElementSibling.nextElementSibling;
            const dislikesElement = likeButtonComment.nextElementSibling.nextElementSibling.nextElementSibling;

            // Send an AJAX request to update the reaction for the specific comment
            fetch(`/like-comment/${commentID}`, {
                method: "POST",
                body: JSON.stringify({ reaction: "like" }),
                headers: {
                    "Content-Type": "application/json",
                },
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);

                // Update the like and dislike counts for the specific comment
                likesElement.textContent = data.likes;
                dislikesElement.textContent = data.dislikes;
                if (data.reaction === 1) {
                    likeButtonComment.style.backgroundColor = "green";
                    dislikeButtonComment.style.backgroundColor ="";
                      } else {
                        likeButtonComment.style.backgroundColor = ""; // Reset the background color
                      }
                // You can handle the response data here
            })
            .catch(error => {
                console.error(error);
            });
        });
    });

    dislikeButtonsComment.forEach(dislikeButtonComment => {
        dislikeButtonComment.addEventListener("click", function (event) {
            event.preventDefault();

            const commentID = dislikeButtonComment.getAttribute("data-comment-id");

            // Select the like and dislike counts for the specific comment
         const   likeButtonComment = dislikeButtonComment.previousElementSibling.previousElementSibling;
            const likesElement = dislikeButtonComment.previousElementSibling
            const dislikesElement = dislikeButtonComment.nextElementSibling;

            // Send an AJAX request to update the reaction for the specific comment
            fetch(`/like-comment/${commentID}`, {
                method: "POST",
                body: JSON.stringify({ reaction: "dislike" }),
                headers: {
                    "Content-Type": "application/json",
                },
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);

                // Update the like and dislike counts for the specific comment
                likesElement.textContent = data.likes;
                dislikesElement.textContent = data.dislikes;
                if (data.reaction === -1) {
                    dislikeButtonComment.style.backgroundColor = "red";
                    likeButtonComment.style.backgroundColor ="";
                      } else {
                        dislikeButtonComment.style.backgroundColor = ""; // Reset the background color
                      }
                // You can handle the response data here
            })
            .catch(error => {
                console.error(error);
            });
        });
    });

        });

        
    </script>
    
   

</body>
</html>
